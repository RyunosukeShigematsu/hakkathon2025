<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home</title>
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
  <h1>ホーム</h1>
  <p id="who" class="muted"></p>

  <div class="card">
    <div class="toolbar">
      <a class="btn primary" href="receipt.html">レシート読み込み</a>
      <a class="btn primary" href="coupons.html">クーポン候補（3つ）</a>
    </div>

    <hr />

    <h2 style="margin:0 0 10px;">所持クーポン</h2>
    <div id="owned"></div>
  </div>

  <div class="toolbar" style="margin-top:12px;">
    <button class="secondary" id="logoutBtn">ログアウト</button>
  </div>

  <script src="../app.js"></script>
  <script>
    requireLoginFromPages();

    const me = getUserId();
    qs("#who").textContent = `ログイン中: ${me}`;

    function renderOwned(){
      const data = loadMyData();
      const list = data.couponsOwned ?? [];
      if(list.length === 0){
        qs("#owned").innerHTML = `<p class="muted">まだクーポンがありません。候補画面から選択してください。</p>`;
        return;
      }
      qs("#owned").innerHTML = `
        <div class="row">
          ${list.slice(0, 5).map(c => `
            <div class="coupon">
              <div><strong>${c.title}</strong></div>
              <div class="muted">割引: ${c.off} 円</div>
              <div class="badges">${(c.tags||[]).map(t => `<span class="badge">${t}</span>`).join("")}</div>
            </div>
          `).join("")}
        </div>
      `;
    }

    renderOwned();

    on("#logoutBtn", "click", () => {
      logoutDemo();
      location.href = "../index.html";
    });
  </script>
</body>
</html>